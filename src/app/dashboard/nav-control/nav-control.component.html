<div class="grid mt-2">
  <div class="col-3">
    <h3 class="mt-0">Menus:</h3>
    <p-listbox
      [options]="menus"
      optionValue="label"
      [(ngModel)]="selectedMenu"
      emptyMessage="Add menu to start"
    >
      <ng-template let-menu #item>
        <div class="flex justify-content-between w-full">
          <span>{{ menu.label }}</span>
          <span (click)="deleteMenu($event, menu)">X</span>
        </div>
      </ng-template>
    </p-listbox>

    <p-inputGroup class="mt-1">
      <input
        type="text"
        pInputText
        placeholder="New Menu"
        [(ngModel)]="pendingMenuName"
        (keyup.enter)="addMenu()"
      />
      <button
        type="button"
        pButton
        class="p-button-success"
        (click)="addMenu()"
      >
        <fa-icon [icon]="icons.add" />
      </button>
    </p-inputGroup>

    <hr />
    <p-button class="p-button-success" (click)="save()" label="Save" />
  </div>
  @if (selectedMenuObj) {
    <div class="col-9 border-left-1">
      <div class="flex gap-2">
        <div class="dragzone">
          <h3>Available Nav Items</h3>
          <ul class="list-none flex flex-column gap-2 p-2 m-0 border-1">
            @for (item of selectableItems; track $index) {
              <li>
                <div
                  pDraggable
                  (onDragStart)="dragStart(item)"
                  (onDragEnd)="dragEnd()"
                  class="p-2 border-round bg-primary cursor-move flex gap-2 justify-content-between"
                >
                  <span>{{ item.label }}</span>

                  @if (item.slug) {
                    <span>/{{ item.slug }}</span>
                  }

                  @if (item.isGenerated) {
                    <fa-icon
                      pTooltip="Children are automatically generated"
                      tooltipPosition="left"
                      [icon]="icons.autoGenerated"
                    />
                  }
                </div>
                @if (item.children) {
                  <ul>
                    @for (child of item.children; track $index) {
                      <li
                        class="p-2 border-round bg-primary cursor-move"
                        pDraggable
                        (onDragStart)="dragStart(child)"
                        (onDragEnd)="dragEnd()"
                      >
                        {{ child.label }}
                      </li>
                    }
                  </ul>
                }
              </li>
            }
          </ul>
        </div>
        <div class="dropzone border-1" pDroppable (onDrop)="itemDropped()">
          <div class="flex">
            <div class="w-6 text-center py-1">Label</div>
            <div class="w-6 py-1 pl-4">Route</div>
          </div>
          <p-tree
            class="w-full md:w-30rem"
            [value]="selectedMenuObj.children"
            [draggableNodes]="true"
            [droppableNodes]="true"
            draggableScope="self"
            droppableScope="self"
            emptyMessage="Add Menu Items"
          >
            <ng-template let-node #default>
              <div
                class="flex justify-content-between w-full align-items-center"
              >
                <p-inplace closable="closable">
                  <ng-template #display>
                    <span>{{ node.label }}</span>
                  </ng-template>
                  <ng-template #content>
                    <input
                      type="text"
                      class="w-9"
                      pInputText
                      [(ngModel)]="node.label"
                    />
                  </ng-template>
                </p-inplace>

                @if (node.slug) {
                  <p-inplace closable="closable">
                    <ng-template #display>
                      <span>/{{ node.slug }}</span>
                    </ng-template>
                    <ng-template #content>
                      <input
                        type="text"
                        class="w-9"
                        pInputText
                        [(ngModel)]="node.slug"
                      />
                    </ng-template>
                  </p-inplace>
                }
                <div class="flex gap-2 align-items-center">
                  @if (node.isGenerated) {
                    <fa-icon
                      pTooltip="Children are automatically generated"
                      tooltipPosition="left"
                      [icon]="icons.autoGenerated"
                    />
                  }
                  <span class="cursor-pointer" (click)="removeItem(node)"
                    >X</span
                  >
                </div>
              </div>
            </ng-template>
          </p-tree>
          <hr />
          <div class="text-right p-2">
            <p-inputGroup class="mt-1">
              <input
                type="text"
                pInputText
                placeholder="Label"
                [(ngModel)]="pendingItem.label"
              />
              <input
                type="text"
                pInputText
                placeholder="Slug"
                [(ngModel)]="pendingItem.slug"
              />
              <button
                type="button"
                pButton
                class="p-button-success"
                [disabled]="!pendingItem.slug || !pendingItem.label"
                (click)="addItem()"
              >
                <fa-icon [icon]="icons.add" />
              </button>
            </p-inputGroup>
          </div>
        </div>
      </div>
    </div>
  }
</div>

<p-confirmPopup />
